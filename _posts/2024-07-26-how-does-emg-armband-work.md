---
layout: post
title: EMG Armband: The Conclusion
tags: ML Systems IoT PCB Designing Embedded
description: Developing an EMG system that can understand human hand motions.
---

## Mentees:
- [Shaunak Datar](https://github.com/ShaunakKDatar)
- [Piyush Patle](https://github.com/PiyushPatle26)
- [Atharva Kshirsagar](https://github.com/vovw)

### This project is sponsored by [Upside Down Labs](https://upsidedownlabs.tech/)
### GitHub Repo: [emgband](https://github.com/vovw/emgband)

# What is our project?
We read Electromyography (EMG) data using sensors, amplify it, filter it, perform ADC conversion, and conduct a frequency analysis (FFT) on it. Using the analyzed data, we train an ML model that can understand what hand movement was performed to get those readings.

![Hardware Flow](/assets/posts/emg-armband/hardware_flow.png)

# What work has been done?
- Initially, we *attempted* to approach this problem from first principles. We implemented the **biopotential signal-acquisition board** from scratch but encountered some issues.
- We then pivoted temporarily to using Upside Down Labs' [EXG Pill](https://github.com/upsidedownlabs/BioAmp-EXG-Pill), which works well.
(Add images of the readings)

## Signal Processing:
- The raw signal goes through a bandpass filter to focus on frequencies between 75 and 150 Hz.
- This filtering helps remove noise and focus on the most relevant part of the EMG signal.

## ADC (Analog-to-Digital Converter)
- Converts the continuous analog signal from the sensor into digital values the microcontroller can process.
- We utilized the entire 12-bit ADC provided in the ESP32.
- We later bound the values and mapped them to reduce the 0-4095 range to 0-1000 readings.

## Bandpass Filter:
- A filter that allows signals between two specific frequencies to pass through while blocking others.
- A bandpass filter which filters the signal and returns a 72.5-725Hz signal is included in the Bio-amp EXG Pill.
- Additionally, we implemented a Band-Pass Butterworth IIR digital filter generated using filter_gen.py.

## Frequency Analysis:
- The code uses the Fast Fourier Transform (FFT) to convert the time-domain signal into frequency components.
- This helps identify which frequencies are most prominent in the EMG signal.
- We used the [Cooley-Tukey Algorithm](https://en.wikipedia.org/wiki/Cooley%E2%80%93Tukey_FFT_algorithm) for the Fast Fourier Transform.

![FFT](/assets/posts/emg-armband/fft.png)

# Storing the Signal
To train our Machine Learning Model, we need to store the readings as data. We initially decided to label two events: Finger Moving and Palm Closing.

We output the data in frequency bins generated by the FFT on the serial port and store it in a .txt file. We wrote a Python script that maps this data from .txt to a CSV format, making it easier to read using pandas in our Model script.

![Flow](/assets/posts/emg-armband/flow.png)

